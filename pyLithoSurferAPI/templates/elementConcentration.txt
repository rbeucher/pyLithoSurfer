{# templates/elementConcentration.txt #}

{
    "name": null,
    "batchId": null,
    "messages": [],
    "columns": [
        {
            "mandatory": false,
            "ignore": false,
            "tableRef": "GCDataPoint",
            "name": "Datapoint Name",
            "number": 1,
            "messages": []
        },
        {
            "mandatory": false,
            "ignore": false,
            "tableRef": null,
            "name": "aliquotName",
            "number": 2,
            "messages": []
        },
        {
            "mandatory": false,
            "ignore": false,
            "tableRef": null,
            "name": "spotID",
            "number": 3,
            "messages": []
        },
        {
            "mandatory": false,
            "ignore": false,
            "tableRef": "LElement",
            "name": "element",
            "number": 4,
            "messages": []
        },
        {
            "mandatory": false,
            "ignore": false,
            "tableRef": "LIsotope",
            "name": "MeasuredMass",
            "number": 5,
            "messages": []
        },
        {
            "mandatory": false,
            "ignore": false,
            "tableRef": null,
            "name": "Conc",
            "number": 6,
            "messages": []
        },
        {
            "mandatory": false,
            "ignore": false,
            "tableRef": null,
            "name": "Uncertainty",
            "number": 7,
            "messages": []
        }
    ],
    "rows": [
        {% for row in rows %}
        {% set outer_loop = loop %}
        {% set ns = namespace(c = 0, col = false) %}
        {% for element in elements %}
        {% if row["concentration"][ns.c] is not none %}
        {{"," if ns.col }}
        {% set ns.col = true %}
        {
            "number": {{ outer_loop.index }},
            "importTime": null,
            "id": null,
            "dirty": false,
            "messages": [],
            "cells": [
                {
                    "value": null,
                    "id": {{ row["gcDatapointId"] }},
                    "column": {
                        "mandatory": false,
                        "ignore": false,
                        "tableRef": "GCDataPoint",
                        "name": "Datapoint Name",
                        "number": 1,
                        "messages": []
                    },
                    "messages": []
                },
                {
                    "value": "{{ row["aliquotName"] }}",
                    "id": null,
                    "column": {
                        "mandatory": false,
                        "ignore": false,
                        "tableRef": null,
                        "name": "aliquotName",
                        "number": 2,
                        "messages": []
                    },
                    "messages": []
                },
                {
                    "value": "{{ row["spotID"] }}",
                    "id": null,
                    "column": {
                        "mandatory": false,
                        "ignore": false,
                        "tableRef": null,
                        "name": "spotID",
                        "number": 3,
                        "messages": []
                    },
                    "messages": []
                },
                {
                    "value": "{{ elements[ns.c] }}",
                    "id": {{ elements_id[ns.c] }},
                    "column": {
                        "mandatory": false,
                        "ignore": false,
                        "tableRef": "LElement",
                        "name": "element",
                        "number": 4,
                        "messages": []
                    },
                    "messages": []
                },
                {
                    "value": "",
                    "id": null,
                    "column": {
                        "mandatory": false,
                        "ignore": false,
                        "tableRef": "LIsotope",
                        "name": "MeasuredMass",
                        "number": 5,
                        "messages": []
                    },
                    "messages": []
                },
                {
                    "value": {{ row["concentration"][ns.c] }},
                    "id": null,
                    "column": {
                        "mandatory": false,
                        "ignore": false,
                        "tableRef": null,
                        "name": "Conc",
                        "number": 6,
                        "messages": []
                    },
                    "messages": []
                },
                {
                    "value": null,
                    "id": null,
                    "column": {
                        "mandatory": false,
                        "ignore": false,
                        "tableRef": null,
                        "name": "Uncertainty",
                        "number": 7,
                        "messages": []
                    },
                    "messages": []
                }
            ]
      }
      {% endif %}{% set ns.c = ns.c + 1 %}{% endfor %}
      {{"," if outer_loop.index != rows|length}}
      {% endfor %}
    ],
    "table": "ElementalConcentration"
}